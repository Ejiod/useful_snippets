import awswrangler as wr
import pandas as pd
from datetime import datetime, timedelta

# Function to generate table names
def generate_table_names(start_date: str, end_date: str):
    start = datetime.strptime(start_date, "%Y%m")
    end = datetime.strptime(end_date, "%Y%m")
    table_names = []
    while start <= end:
        table_name = f"table_{start.strftime('%Y%m')}"
        table_names.append(table_name)
        # Increment by one month
        start += timedelta(days=32)
        start = start.replace(day=1)
    return table_names

# Generate table names from October 2008 to October 2024
table_names = generate_table_names("200810", "202410")

# List to hold DataFrames
dataframes = []

# Database name
database_name = "your_database_name"

# Loop through table names, read data, and append to the list
for table_name in table_names:
    query = f"SELECT customer_id, acc FROM {table_name}"
    df = wr.athena.read_sql_query(query, database=database_name)
    dataframes.append(df)

# Concatenate all DataFrames
combined_df = pd.concat(dataframes, ignore_index=True)

# Optionally, drop duplicates if needed
combined_df = combined_df.drop_duplicates()

# Now combined_df contains the combined data from all tables
print(combined_df)